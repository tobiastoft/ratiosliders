function RatioSegment(c){this.owner=c;this.elmId="handle"+this.owner.segments.length;this.popupId=c.elmId+"-"+this.elmId+"-popup";this.minWidth=10;this.maxWidth=c.total;this.obj="#"+c.elmId+">#"+this.elmId;this.label="Undefined";this.wentSmaller=!1}
RatioSegment.prototype.addHtml=function(){$("#"+this.owner.elmId).append('<div class="handle" id="'+this.elmId+'"><div id="content">0%</div></div>');$("body").append('<div class="popup" id="'+this.popupId+'"><div id="content"><div id="label"></div><div id="percentage"></div></div></div>');this.setPopupText(this.label)};
RatioSegment.prototype.makeResizable=function(){var c=$("#"+this.owner.elmId).width()/this.owner.total*this.owner.increment;$(this.obj).resizable({axis:"x",containment:"parent",minWidth:this.minWidth,maxWidth:this.maxWidth,grid:[c,c],handles:"e"})};RatioSegment.prototype.setRatio=function(c){if(c==void 0)c=this.originalRatio;$(this.obj).width(c*$("#"+this.owner.elmId).width())};RatioSegment.prototype.getRatio=function(){return $(this.obj).width()/$("#"+this.owner.elmId).width()};
RatioSegment.prototype.setPopupText=function(c){$("#"+this.popupId+">#content>#label").text(c)};RatioSegment.prototype.setPercentage=function(c){$("#"+this.popupId+">#content>#percentage").text(c);$(this.obj+">#content").text(c)};
function RatioSlider(c,b){this.segments=[];this.elmId=c;this.segmentMinWidth=10;this.increment=1;if(b==void 0)try{b=$.parseJSON($("#"+c).val())}catch(a){alert('Missing or malformed JSON received through\nfield value for slider named "'+c+'."');return}this.initialSetup=b;this.total=b.total;this.init()}
RatioSlider.prototype.init=function(){var c='<div class="ratioslider" id="'+this.elmId+'"><div id="total"></div><div id="reset">Reset</div><input type="hidden" name="'+this.elmId+'"/></div>';$("input#"+this.elmId).replaceWith(c);$("#"+this.elmId+">#total").text(this.total+"%");$("#"+this.elmId+">#reset").bind("click",{that:this},this.resetSlider);var b=this;$.each(this.initialSetup.segments,function(a,c){b.addSegment(a,c)});this.attachHandles();this.adjustSegments();this.outputData(!0)};
RatioSlider.prototype.resetSlider=function(c){for(var c=c.data.that,b=0;b<c.segments.length;b++)c.segments[b].setRatio();c.adjustSegments()};RatioSlider.prototype.addSegment=function(c,b){var a=new RatioSegment(this);a.label=c;a.originalRatio=b;this.segments.push(a)};
RatioSlider.prototype.attachHandles=function(){for(var c=this.segments.length,b=0;b<c;b++)this.segments[b].addHtml(this.elmId),this.segments[b].setRatio(),this.segments[b].maxWidth=$(this.obj).width()-this.segmentMinWidth*(c-1),b<c-1&&(this.segments[b].makeResizable(),$(this.segments[b].obj).bind("resizestart",{that:this},this.startResizing),$(this.segments[b].obj).bind("resizestop",{that:this},this.stopResizing))};
RatioSlider.prototype.startResizing=function(c,b){var a=c.data.that;$(b.element).bind("resize",{that:a},a.adjustSegments);for(var e=0,e=0;e<a.segments.length-1;e++)a.segments[e].originalRight=$(a.segments[e].obj).width()+$(a.segments[e].obj).offset().left,a.segments[e].originalWidth=$(a.segments[e].obj).width(),a.segments[e].wentSmaller=!1;for(e=0;e<a.segments.length;e++)if(a.segments[e].elmId==$(b.element).attr("id")){var m=$(a.segments[e].obj).offset().left,e=$("#"+a.elmId).width()-m-(a.segments.length-
e-2)*a.segmentMinWidth;$(b.element).resizable("option","maxWidth",e);break}};RatioSlider.prototype.stopResizing=function(c,b){var a=c.data.that;$(b.element).unbind("resize",{that:a},a.adjustSegments);a.returnRatios(!0)};
RatioSlider.prototype.adjustSegments=function(c,b){var a,e=0;try{a=c.data.that}catch(m){a=this}var l=$("#"+a.elmId).width(),f;try{for(var d=0;d<a.segments.length-1;d++)a.segments[d].elmId==$(b.element).attr("id")&&(f=d)}catch(n){f=0}try{e=c.pageX-$(b.element).offset().left}catch(o){}e<0&&f>0&&($(b.element).offset().left+e>a.segmentMinWidth*(f+1)?(d=$(b.element).offset().left+e,e=$("#"+a.elmId).width()/a.total*a.increment,d=e*Math.round(d/e),$(b.element).offset({left:d})):$(b.element).offset({left:a.segmentMinWidth*
(f+1)}));for(d=f-1;d>=0;d--){var g,j=a.segments[d],k=a.segments[d+1],i=$(a.segments[d].obj),h=$(a.segments[d+1].obj),e=i.offset().left;g=h.offset().left-i.offset().left;if(d>0){if(g<a.segmentMinWidth)g=a.segmentMinWidth;e=h.offset().left-g}if(i.width()<j.originalWidth)j.wentSmaller=!0;h.width()>k.originalWidth&&k.wentSmaller&&(j=h.width()-k.originalWidth,g+=j,h.offset({left:h.offset().left+j}),h.width(h.width()-j));if(g<a.segmentMinWidth)g=a.segmentMinWidth;i.width(g);i.offset({left:e})}for(d=f;d<
a.segments.length-1;d++){k=a.segments[d+1];j=a.segments[d];h=$(k.obj);i=$(j.obj);h.offset({left:i.offset().left+i.width()});g=k.originalRight-h.offset().left;if(g<a.segmentMinWidth)g=a.segmentMinWidth;h.width(g)}for(d=f=0;d<a.segments.length-1;d++)f+=$(a.segments[d].obj).width();$(a.segments[a.segments.length-1].obj).width(l-f);l=0;f=[];for(d=a.segments.length-1;d>=0;d--)e=a.segments[d],g=$(e.obj),i=$("#"+e.popupId+">#content"),$("#"+e.popupId).offset({left:g.offset().left,top:g.offset().top}),d<
a.segments.length-1&&(i.offset().left+i.width()+10>$("#"+a.segments[d+1].popupId).offset().left?l++:l=0),f.push(l);f.reverse();for(d=0;d<f.length;d++)$("#"+a.segments[d].popupId+">#content").removeClass(),$("#"+a.segments[d].popupId+">#content").addClass("overlap-"+f[d]);a.returnRatios()};
RatioSlider.prototype.returnRatios=function(c){ratios=[];for(var b=0;b<this.segments.length;b++){var a=Math.round(this.segments[b].getRatio()*100)/100;ratios.push(a);this.segments[b].setPercentage(Math.round(a*this.total)+"%");$(this.segments[b].obj).width()<30?($("#"+this.segments[b].popupId+">#content>#percentage").show(200),$(this.segments[b].obj+">#content").hide(200)):($("#"+this.segments[b].popupId+">#content>#percentage").hide(200),$(this.segments[b].obj+">#content").show(200))}c&&this.outputData(ratios)};
RatioSlider.prototype.outputData=function(){for(var c='{"segments":{',b=0;b<this.segments.length;b++)c+='"'+this.segments[b].label+'":'+Math.round(this.segments[b].getRatio()*100)/100,b<this.segments.length-1&&(c+=",");c+='},"total":'+this.total+"}";$('input[name="'+this.elmId+'"]').val(c)};